<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KVStore Hypothesis Runner</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.11.1/core.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <style>
        :root {
            color-scheme: light;
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            margin: 0;
            padding: 20px;
        }

        .nav {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid #e1e4e8;
            background: #fff;
            margin: -20px -20px 12px;
        }

        .nav a {
            text-decoration: none;
            color: #24292f;
            padding: 6px 10px;
            border-radius: 6px;
        }

        .nav a.active,
        .nav a:hover {
            background: #f6f8fa;
        }

        h1 {
            margin: 0 0 12px;
            font-size: 20px;
        }

        .row {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 12px;
        }

        .row.split {
            grid-template-columns: minmax(0, 1fr) 6px minmax(0, 1fr);
            align-items: stretch;
        }

        .splitter {
            background: #e1e4e8;
            border-radius: 4px;
            cursor: col-resize;
            min-height: 40px;
        }

        .splitter:hover {
            background: #d5dadd;
        }

        .panel {
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 12px;
            background: #fff;
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 12px;
        }

        .muted {
            font-size: 12px;
            color: #666;
        }

        button {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #ccd1d5;
            background: #f6f8fa;
            cursor: pointer;
        }

        select,
        input[type="text"] {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccd1d5;
        }

        pre {
            margin: 0;
            max-height: 60vh;
            overflow: auto;
            max-width: 100%;
        }

        /* Bound code/output areas; resizing handled by splitter */
        #code-view,
        #test-output {
            resize: none;
            overflow: auto;
            max-width: 100%;
        }

        /* Prevent grid children from forcing overflow */
        .row>.panel {
            min-width: 0;
        }

        .tabs {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .tab {
            padding: 6px 10px;
            border: 1px solid #ccd1d5;
            border-radius: 6px;
            background: #f6f8fa;
            cursor: pointer;
        }

        .tab.active {
            background: #eaeef2;
        }
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html">App</a>
        <a href="tests.html" class="active">Hypothesis</a>
    </nav>
    <h1>KVStore Hypothesis Runner</h1>
    <div class="panel">
        <div class="tabs" id="tabs"></div>
        <div class="row split" id="split-row">
            <div class="panel">
                <h3 class="muted" style="margin:0 0 6px;">Test Source</h3>
                <div class="toolbar" style="margin:0 0 8px;">
                    <button id="btn-edit">Edit</button>
                    <button id="btn-save" style="display:none;">Save</button>
                    <button id="btn-cancel" style="display:none;">Cancel</button>
                </div>
                <pre id="code-view"><code id="test-code" class="language-python"></code></pre>
                <textarea id="editor"
                    style="display:none;width:100%;height:60vh;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 12px; line-height: 1.4; padding: 8px; box-sizing: border-box;"></textarea>
            </div>
            <div class="splitter" id="splitter" aria-label="Resize panels" title="Drag to resize"></div>
            <div class="panel">
                <h3 class="muted" style="margin:0 0 6px;">Output</h3>
                <pre id="test-output"></pre>
            </div>
        </div>
        <div class="row" style="margin-top:12px;">
            <div class="panel">
                <h3 class="muted" style="margin:0 0 6px;">@given tests</h3>
                <div id="tests-list" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
            </div>
            <div class="panel">
                <h3 class="muted" style="margin:0 0 6px;">@composite generators</h3>
                <div class="toolbar" style="margin:0 0 8px;">
                    <span class="muted">count</span>
                    <input id="component-count" type="text" value="5" style="width:64px;">
                </div>
                <div id="gens-list" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
            </div>
        </div>
        <p class="muted" id="test-note" style="margin-top:8px;"></p>
    </div>

    <py-config>
        packages = ["hypothesis==6.112.1", "attrs>=22"]
        [[fetch]]
        from = "."
        files = ["__init__.py", "message.py", "store.py", "client.py", "trace.py",
        "test_message.py", "test_trace.py", "test_trace_stateful.py",
        "test_isolation.py", "test_multiclient.py", "test_containment.py",
        "tests_app.py"]
    </py-config>

    <py-script src="tests_app.py"></py-script>
    <script>
        // Simple split-row drag to resize columns
        (function () {
            const row = document.getElementById('split-row');
            const splitter = document.getElementById('splitter');
            if (!row || !splitter) return;
            let dragging = false;
            function onMove(e) {
                if (!dragging) return;
                const rect = row.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const pct = Math.max(10, Math.min(90, (x / rect.width) * 100));
                row.style.gridTemplateColumns = `minmax(0, ${pct}%) 6px minmax(0, ${100 - pct}%)`;
            }
            splitter.addEventListener('mousedown', function (e) {
                dragging = true;
                document.body.style.userSelect = 'none';
                window.addEventListener('mousemove', onMove);
            });
            window.addEventListener('mouseup', function () {
                if (!dragging) return;
                dragging = false;
                document.body.style.userSelect = '';
                window.removeEventListener('mousemove', onMove);
            });
        })();
    </script>
</body>

</html>